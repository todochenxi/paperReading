# MetaGpt

## summarize

- MetaGPT是一个利用元编程来协调大语言模型(LLM)的多智能体系统,以实现协作问题解决的框架。
- 它将人类工作流程和标准操作过程(SOP)融入到系统设计中,以增强结构化协调并减少LLM幻觉带来的错误。
- SOP被编码成提示来引导掌握域内专业知识的智能体。智能体产生模块化的、标准化的输出来方便知识共享。
- 该框架具有两层架构 - 基础组件层如环境、角色、动作等,以及协作机制层如知识共享和工作流程封装。
- 角色被全面定义以赋予智能体与现实世界实践相符的专业能力。
- 动作将SOP实例化为可执行的提示与标准化输出。这将约束LLM的行为。
- 智能体通过与环境的交互主动观察、思考、反思和积累知识。
- 知识共享使用去中心化的基于角色的内存缓存,跨智能体同步。
- 在软件开发中,MetaGPT协调5个专业角色 - 产品经理、架构师、项目经理、工程师、质量保证工程师。
- 代码生成基准测试表明MetaGPT取得了新的最优结果,证明了其效力。
- 对比突出了MetaGPT的多智能体协作、SOP集成以及全面的工作流程覆盖范围的优势。
- 该论文展示了元编程和人类洞见如何改变LLM多智能体系统来处理复杂的现实世界任务。

## abstract
近期,利用大语言模型(LLM)驱动的多智能体在自动化任务解决方面取得了显著进步。然而,现有的基于LLM的
多智能体工作主要聚焦于解决简单的对话任务,很少研究复杂任务,主要是由于LLM的幻觉问题。当简单地链式
组合多个智能体时,这种幻觉会级联放大,导致无法有效解决复杂问题。因此,我们提出了MetaGPT,一个创新框架,
它将高效的人类工作流程作为元编程方法集成到基于LLM的多智能体协作中。具体来说,MetaGPT将标准操作过程
(SOP)编码成提示,以增强结构化协调。随后,它规定了模块化输出,赋予智能体与人类专业水平相当的域专业知识,
以验证输出并最大限度地减少综合错误。通过这种方式,MetaGPT利用装配线范式为各种智能体分配不同的角色,从
而建立一个框架,可以有效且凝聚力地拆解复杂的多智能体协作问题。我们在协作式软件工程基准测试中进行的实验表明,
与现有的基于聊天的多智能体系统相比,MetaGPT生成的解决方案更加连贯正确。这凸显了将人类域知识集成到多智能体
系统中的潜力,从而为协作型LLM系统的更有效设计提供了新的契机。该项目的GitHub存储库已公开,网址为:https://github.com/geekan/MetaGPT。

## 1. 简介
利用大语言模型(Large Language Model, LLM)的多智能体系统为复制和增强人类工作流程提供了卓越的前景。然而,现有的系统[1,2,3,4,5,6,7]倾向
于过 于简化现实世界应用程序中的复杂性。这些系统主要面临着通过会话和基于工具的交互来促进有效协作的挑战。这导致了实现连贯交互、减轻非产性反馈循环以及
引导有意义的协作互动等问题[2,3,8,9,10]。与此同时,通过长期的协作实践,人类已经在许多领域开发了广泛接受的标准操作过程(SOP)[11,12,13]。
这些SOP在支持任务分解和高效协调方面发挥着关键作用。对这些现实世界实践的全面理解和集成至关重要。通过解决这些普遍存在的局限性并将这些洞见作为
元编程进行集成,我们可以促进LLM驱动的多智能体系统设计和组织范式的出现,从而增强其效力和适用性。

此外,SOP概述了团队成员之间的职责,并为组件输出设置了标准,以确保任务的执行方式与定义的角色和质量标准一致[11,12,13,14]。在软件工程中,瀑布方法
从需求分析到交付阶段进行了顺序阶段划分,以促进跨角色的团队合作[11,12]。此外,人类角色拥有量身定制的专业知识,专门用于其分配的责任。软件工程师
利用他们的编程熟练程度来实现代码,而产品经理则进行市场分析以制定业务需求。尽管如此,如果没有标准化输出,协作就会变得无序[15,14,16]。例如,产品经
理分析竞争对手和用户需求以创建具有标准化结构的产品需求文档(PRD),这可以指导开发过程。这种规范性工件对于推进需要各种角色相互关联的贡献的复杂、多
方面的项目至关重要,这些项目需要互联的贡献[17,18,19]。因此,在MetaGPT中,我们赋予代理生成标准操作输出的能力,例如高质量的需求文档、设计工件、
流程图和接口规范。这些中间标准化输出极大地提高了最终代码执行的成功率。
为了很好地组织多智能体协作中的SOP,我们进一步引入了一种新的元编程机制[20],它允许程序将其他程序作为数据进行操作。具体技术使程序能够在运行时自
动生成、分析、转换和修改代码。这为适应性和灵活的编程能力提供了基础。通过这种方式,SOP充当一个元函数,以团队和需求为输入来合成目标代码。当SOP与专
门的团队(包括软件代理)一起实施时,它有效地创建了一个根据给定输入生成代码的编程函数。从本质上讲,通过将标准化流程与协调的多智能体系统相结合,元编程
可以用来利用代理合作以动态构建用于编程任务(如代码生成)的函数。这展示了元编程如何利用基于代理的技术启用软件合成的灵活和自动化。
在这项工作中,我们提出了MetaGPT,一种利用SOP来协调基于LLM的多智能体系统的元编程技术。SOP为我们组织多代理协作的策略,增强了他们协作努力的效率
。首先,每个代理都由描述性信息标识,这允许系统使用适当的角色特定提示前缀进行初始化。这种方法将域知识集成到代理定义中。其次,我们分析了高效的人类工
作流程,以封装协作任务所需的过程知识。这些SOP被编码到代理体系结构中,使用基于角色的操作规范。最后,共享环境连接代理,为它们的操作提供可见性,并使其
能够协作、访问工具和共享资源。代理产生标准化的操作输出以促进知识共享。此外,MetaGPT中的代理可以主动观察和检索相关信息,这比被动地通过对话接收数
据更有效。该环境反映了人类工作场所的基础设施,以促进团队协作。

为了演示我们设计的有效性,我们展示了协作软件开发工作流程,并进行实验来实现相关代码。在代码生成基准测试中,MetaGPT以81.7%和82.3%的准确率取得了新
的最先进成果。与直接方法相比。与其他基于LLM的编程框架(如AutoGPT [21]、LangChain [22]和AgentVerse [23])相比,MetaGPT可以处理明显更高水平
的软件复杂性,并通过其广泛的功能区分自身。值得注意的是,在我们的实验评估中,我们已经实现了100%的任务完成率,这进一步强调了MetaGPT框架的健壮性和效率。

总之,我们的研究概述了通过集成SOP将LLM为基础的多智能体系统转变为创新的范例。MetaGPT证明了元编程的潜力,特别是在基于LLM的多智能体环境中。先进的
模型驱动技术与结构化过程和代理协作的这种融合正在改变软件开发的格局。我们的努力做出的重大贡献包括:

引入元编程框架。我们提出了MetaGPT,一个用于LLM基础多智能体协作的高级框架。元编程范式使MetaGPT非常方便和灵活地构建多智能体系统。这为团队提供了
一个轻松的平台,可以轻松地开发和验证协作多智能体系统。
集成人类SOP流程设计。在一次开创性的努力中,我们成功地将SOP集成到系统设计中。这种集成使我们基于LLM的代理能够生成不同的、高质量的、结构化的中间设
计和文档。它通过减少LLM基础多智能体协作中的错误显着增强了健壮性。这种设计使系统具备按照人类团队的方式系统地解决复杂任务的能力,展示了与人类团队
相似的解偶能力和问题解决能力。
实现最先进的性能。我们通过严格的实验在HumanEval [24]和MBPP [25]基准测试中取得了新的最先进性能。广泛的定量和定性分析令人信服地验证了MetaGPT
在多智能体编程和复杂任务解析方面的有效性。结果表明,MetaGPT有潜力解决LLM中的幻觉问题,从而引导面向更有效设计的协作LLM系统。

## 2. 相关工作

### 2.1 基于LLM的自动编程
自动编程是NLP中的一个热门研究主题。研究人员训练了分类器来识别和拒绝错误程序[26],并开发了迭代反馈机制来生成嵌入式控制程序[27]。还有一些最先进的
方法利用多数表决来选择候选程序[28],并使用执行结果来改进程序合成[29,30]。最近,基于LLM [31,32,33]的代理促进了自动编程的发展。李等人[2]提出了
一个简单的角色扮演代理框架,该框架通过两个角色的交互,根据一行用户需求实现自动编程。此外,钱等人[10]利用多个代理进行软件开发,但他们没有融入先进的
人类团队合作经验。虽然现有的多智能体合作[2,10]目前提高了生产力,但他们没有充分利用人类生产实践中的高效工作流程。因此,他们很难解决更复杂的软件工程问题。

此外,需要提到本文所依据的一系列基础工作。ReAct [31]使用链式思维提示 [34]来生成推理轨迹和行动计划与LLM。Reflexion [32]通过自我反思推断更直
观的未来动作。这两篇论文都说明Re-Act样式的循环推理是赋予基于LLM代理推理能力的一个好的设计范式。ToolFormer [35]可以通过简单的API自我教会使用
外部工具。SWIFTSAGE [33]将困难的情况分配给慢性思考处理,而正常情况则由快速思考直接处理。在上述设计的基础上,我们强调分工对复杂任务处理有帮助。

### 2.2 多智能体协作
先前的工作已经探索了在协作环境中使用多个LLM来解决复杂任务[36,10]。其动机是通过跨代理交互,LLM可以汇集各自的优势,集体展现增强的性能。之前对多智
能体的探索包括集体思考[4,5,6,7]、对话数据集收集[2,37]、社会学现象研究[1,38]和效率协作[3,8,2,10]。(i)集体思考:许多高级工作[4,5,6,7]通过
集成多代理讨论来增强任务解决能力。(ii)对话数据集收集:魏等人[37]和李等人[2]通过角色扮演构建了对话数据集。(iii)社会学现象研究:Park等人[1]建造
了一个由25个代理组成的城镇,实现了代理之间简单的语言交互、社会认知和记忆,但缺乏合作和生产。Akata等人[38]通过让多个代理反复玩游戏来研究LLM的合
作和协调行为。(iv)效率协作:蔡等人[3]通过大模型作为工具制造者和小模型作为工具使用者的组合来对成本进行建模。张等人[8]建立了一个代理之间进行语言
交流、协作和提高效率的框架。李等人[2]和钱等人[10]提出了一个用于软件开发的多智能体框架。然而,他们之间的跨代理交流是自然语言对话,而不是标准化的软
件工程文档,也没有融入先进的人类流程管理经验。关键问题在于多智能体合作周围保持连贯性,避免非产性循环,以及指导有益的互动。因此,本文强调在多智能体
系统中实践先进的人类流程(例如软件开发中的SOP)。
### 2.3 自治系统设计
现有的自治系统,如AutoGPT [21],通过将高级目标分解为多个子目标并在ReAct样式的循环中执行它们来自动化任务,在连贯性和验证方面面临挑战。LangChain
[22] 帮助开发人员结合其他计算工具或知识库开发LLM应用程序。最近,多智能体体系结构已被证明是一种有效的设计。GPTeam [39] 创建基于LLM的多个代理共
同完成预定目标。AgentVerse [23]是一个LLM驱动的多智能体场景模拟框架。Langroid [40]构建基于LLM的多智能体编程。SocraticAI [41]通过在修辞
对话中利用多个代理的力量来改进问题解决。由于大多数系统没有嵌入到先进的人类管理经验中,因此无法解决更大、更复杂的现实世界项目。我们的MetaGPT集成
了人类工作流程洞察力,以实现更可控和验证的性能。

## 3 通过标准操作程序对协作代理进行元编程
在本节中,我们首先概述MetaGPT,我们提出的用于解决复杂现实世界问题的元编程多智能体协作框架,如图2所示。然后,在第3.2节中,我们将详细阐述框架中的核心
组件设计。我们选择软件开发作为示例,以说明MetaGPT如何调度多个代理来实现软件开发团队中的SOP,从而只需要一个人类输入任务要求就可以完成端到端的开发过程。

此外,在第3.3节中,我们将介绍一个实际示例(如图3所示),以说明MetaGPT如何协调具有相应角色的多个代理来满足一行要求:制作2048滑动拼图游戏。

### 3.1 框架概述
通过调查MetaGPT的核心架构、其知识共享组件以及复杂工作流背后的原理,我们检查该框架的设计和工作流程。MetaGPT的设计组织为两个不同的层次。
基础组件层。这一层建立了单个代理操作和系统范围信息交换所需的核心构建块,包括环境、内存、角色、操作和工具。如图2所示,环境支持共享工作区和通信。
内存存储和检索历史消息。角色封装特定领域的技能和工作流程。操作执行模块化子任务。工具提供通用服务和实用程序。这一层为代理在分配的角色中运行、
相互交互并与系统交互提供了基础架构。
协作层。在基础组件层的基础上构建,协作层协调单个代理进行协作,以解析复杂问题。它建立了合作所必需的关键机制:知识共享和工作流程封装。

- 知识共享。这一机制使代理能够有效交换信息,为共享知识库做出贡献。代理可以在不同的粒度级别存储、检索和共享数据。它不仅增强了协调,还减少了冗余交流,从而提高了整体运营效率。
- 封装工作流程。这一机制利用SOP将复杂任务分解为较小的、可管理的组件。它将这些子任务分配给合适的代理,并通过标准化输出监督他们的表现,以确保其操作符合总体目标。

将其分解为基础和协作层有助于模块化,同时确保单个和集体代理功能。这些组件提供了可重用的构建块和实用程序,而协作模块则实现了有目的的协调。
3.2 核心机制设计

3.2.1 角色定义

MetaGPT框架有助于创建各种专业化的角色类,例如产品经理、架构师等,这些类都继承自基本角色类。基本角色类的特点是一组关键属性:名称、配置文件、目标、约束和描述。具体来说,配置文件体现了角色或职位的领域专长。例如,架构师的配置文件可能包括软件设计,而产品经理的配置文件可能集中于产品开发和管理。目标表示角色试图完成的主要责任或目标。产品经理的目标可以用自然语言表达为有效创建成功的产品。约束表示角色执行操作时必须遵循的限制或原则。例如,工程师可能有约束,要求他编写标准化、模块化和可维护的代码。约束可能会规定,您编写的代码应符合PEP8等代码标准,模块化,易于阅读和维护,如图2所示。描述提供了其他具体的身份信息,以帮助建立一个更全面的角色。

MetaGPT框架中的角色初始化使用自然语言全面描述每个角色的责任和约束。角色不仅有助于人类理解,还可以引导LLM生成与角色概况、目标和能力相符的操作,使每个代理在各自的任务中都很专业。我们将这个过程定义为锚定代理,它帮助人类将特定领域的责任和功能编码到基于LLM的代理中,并增加行为指导以实现预期功能。我们将在3.2.2节中进一步讨论这一点。

例如,在MetaGPT中可以使用特定于角色的设置来初始化软件公司的工程师角色,如图2所示:角色:您是一个[简介]名为[名称],您的目标是[目标],约束是[约束]。

MetaGPT框架提供的角色全面定义使创建高度专业化的基于LLM的代理成为可能,每个代理都针对特定的领域和目标进行了定制。角色定义不仅引入了基于预期功能的行为指导层,还方便创建多样化和专业化的代理,每个代理在其领域都是专家。这导致能够处理广泛任务的更加有效和高效的基于LLM的代理的发展。

在MetaGPT中,智能体不仅可以接收和响应信息,还可以观察环境以提取关键细节。这些观察指导其思考和后续行动。最后,从环境中提取了重要信息,并存储在记忆中以备将来参考,有效地使每个代理成为主动学习者。

这些代理承担特定的角色,并遵循某些关键行为和工作流程,如图2所示:

思考和反思。角色可以检索角色描述来构架思考,然后反思需要做什么以及决定下一步行动,通过_think()函数。“先思考,再行动”——谨慎考虑后再回复

观察。角色可以观察环境并基于观察进行思考/行动,使用_observe()函数。他们关注重要信息,并将其纳入记忆以丰富对上下文的理解并指导未来决策。

广播消息。角色可以使用_publish_message()函数将消息广播到环境中。这些消息包含有关当前执行结果和相关操作记录的详细信息,用于发布和共享信息。

知识沉淀和行动。角色不仅是广播者,也是来自其环境的信息的接收者。角色可以评估进入消息的相关性和及时性,从共享环境中提取相关知识并维护内部知识库以通知决策。它们通过咨询具有丰富上下文信息和自我知识的LLM来执行操作。将执行结果封装为消息,而规范工件则通过环境共享。

状态管理。角色可以通过更新工作状态和监控待办事项列表来跟踪其操作。这使得一个角色能够在不中断的情况下顺序处理多个操作。在执行每个操作时,角色首先会锁定其状态。完成操作后,它会将状态标记为未锁定。这可以防止其他操作中断工作流程。这是角色设计中的一个关键功能,使角色的执行动态更具人性化。它基于现实世界人类协作现象,赋予角色更自然的执行动力。

总之,MetaGPT框架是设计和实现具有专业能力的智能体的通用且强大的方法。在广泛的应用和领域中,这些代理在角色功能的帮助下可以有效地进行协作、学习、适应和执行各种任务,使它们成为许多应用中的宝贵资产。

3.2.2 实例化SOP的提示

如前所述,MetaGPT使用提示来实例化现实世界的SOP到明确定义的代理工作流中。我们演示MetaGPT如何通过自然语言提示将SOP转化为可执行的操作实例。这个过程涉及使用提示基于确立的实践实例化SOP,根据确立的实践提供循序渐进的指导,并确保一致、结构化地执行复杂的顺序任务。

首先,我们详细介绍Action类,然后演示设计规范化动作粒度级提示的方法。在MetaGPT框架中,Action充当代理执行特定任务的原子单元,通过自然语言进行指定。关键属性包括:

前缀。注入特定于角色的提示前缀,为角色特定提示配置标识符。

LLM代理。每个Action都包含一个LLM代理,可以通过aask()方法调用,使用自然语言提示丰富操作细节。另外,可以在Action类中实现各种特定于角色的上下文解析函数。这些函数旨在从输入中提取并提供足够的上下文信息给LLM。这些解析器可以从输入中选择性地提取最相关的信息,以创建清晰、集中于LLM代理的提示,从而确保为LLM提供足够的上下文生成有用的输出,而不会被过量的无关数据淹没。

标准化输出模式。一种结构化表示,定义预期的输出模式,用于提取结构化数据。我们提供基本方法来解析LLM结果为结构化输出。

指示内容。可以使用标准化输出模式从操作输出中提取结构化数据。最终,此信息被封装为消息并发布到环境中。

重试机制。由尝试次数和等待时间定义,以实现操作的重试以提高健壮性。

总之,MetaGPT中的每个操作都需要定义标准化输出,通过编码高质量专家级的结构关键点。然后LLM根据特定任务的标准化输出模式进行细化操作。本质上,我们为每个操作提供了一个提示模板,该模板符合角色的标准。该模板有助于引导LLM的行为,以生成规范化输出。

我们在MetaGPT中定义ProductManager代理的WritePRD操作,以展示该过程。如图3所示,我们通过指定所需的输出(包括产品目标、用户故事、竞争分析、需求分析和优先需求池)将该操作的领域专业知识融入其中,这些输出封装了产品管理的关键工件和最佳实践,遵循行业惯例。此外,我们为ProductManager代理实现了支持技能,例如网络搜索API以增强分析,以及诸如mermaid [42]之类的图表工具来可视化竞争四象限图。ProductManager可以高效地组织输出部分。通过将与现实世界产品经理职责相符的这些互补功能赋予代理,WritePRD操作可以在遵循标准化工作流程的同时执行子任务。

以这种方式,WritePRD操作演示了MetaGPT操作定义如何将领域知识、输出模式和辅助技能相结合,将高级SOP转化为可执行且可自定义的代理程序。通过将行之有效的最佳实践融入操作规范中,MetaGPT将理论专业知识与结构化执行相连接,后者可为协作工作流程定制。此外,每个操作不再仅仅是一个隔离的功能。它构成了一套全面的指导方针,这些指导方针约束LLM在其角色内的行为,以确保产生高质量、组织良好且特定于任务的输出。

3.2.3 用于标准化输出的操作

MetaGPT实例化工作流程的有效性在很大程度上依赖于每个操作的标准化输出。这些输出利用专家领域知识和行业最佳实践将工作流程适配于特定的角色和上下文。

结构化输出设计服务于以下目的:

    标准化输出促进与代理职责一致、可预测、可重复且符合预期的LLM结果生成。它们通过设置输出预期来指导高质量、结构化和特定于任务的LLM生成。
    此外,标准化模式充当约束LLM行为在适当边界内的蓝图。这有助于保持对目标任务的关注,并防止走题。由于操作构成了角色的全面指导方针的一部分,这种以角色为中心的引导确保输出与现实世界质量标准保持一致。

我们的方法的功能和效果在更复杂的系统设计中得到了证明,这些设计超出了简单的游戏示例,例如内容推荐引擎、搜索算法框架和基于LLM的操作系统。更详细的结果可以在附录A中找到。

如图4所示,架构师代理生成了详细的系统级图,描述了软件体系结构。该图包括对关键模块(如User、CollaborativeFilteringModel和Recommender)的清晰定义。该图还补充了有关每个模块中的关键字段和方法的信息,这有助于工程师更好地理解基本工作流程和功能组件。

此外,设计整合了模块之间的调用关系,遵循关注分离和松耦合的系统级原则。从人类自然语言到结构化技术设计的转换提供了特定且实用的信息,这可以帮助实现工程项目,而不仅仅停留在概要总结。

虽然系统设计提供了整体框架和模块化设计,但对于实现复杂系统编码,它仍然不足够。工程师仍需要关于在模块内外执行操作的其他详细信息,以将设计转换为功能代码。如图5所示,架构师还创建了一个顺序流程图,根据系统接口设计描述参与的过程、对象和执行功能所需的消息交换顺序。如前所述,这些补充详情使协作变得更容易,特别是对于负责详细制定代码设计的工程师和项目经理。

因此,架构师角色产生连贯协同的输出对于通过指定化简化从规范到功能代码的工程师任务翻译至关重要。它们减少了自由格式自然语言可能出现的模糊、误解和困惑。

总之,MetaGPT中标准化输出的设计和实现提供了一个强大的工具来处理复杂任务。将自然语言定义的复杂任务转换为标准化输出有助于推动协作的一致性,从而减少可能导致不连贯的过度对话环节的需要。此外,它可以清晰一致地表示结构信息,仅仅通过自然语言是很难传达明确的,特别是对于基于LLM的代理。通过提供这些结构化和标准化的输出,不同的代理对自己的任务和责任有清晰一致的理解。这种方法不仅简化了沟通,还增强了基于LLM的多智能体系统管理和执行复杂任务的能力。

3.2.4 知识共享机制和定制化知识管理

在MetaGPT中,每个代理主动整理其个性化知识,方法是从共享环境日志中检索相关的历史消息。代理不再被动地依赖对话,而是利用基于角色的兴趣提取相关信息。具体来说,环境复制消息以提供统
一的数据源。代理根据对其角色有意义的消息类型注册订阅。匹配的消息自动发送通知给适当的代理。在内部,代理维护一个内存缓存,该缓存按内容、发布代理和其他属性索引订阅的消息。检索机制使代理能够通过查询此存储获取其他上下文详细信息。链接代理之间的更新同步内存,以保持一致的视图。这种去中心化但统一的访问模式反映了人类组织的运作方式。团队成员共享记录,但根据各自的职责自定义视图。通过根据代理角色组织信息流,MetaGPT使自治代理能够有效访问相关知识。

如前所述,MetaGPT中的每个代理都维护一个内存缓存,该缓存根据内容、发送者和接收者索引与其角色相关的订阅消息,以实现个性化知识整理。具体来说,消息的集中复制创建了统一的数据源。代理可以根据这个源自动接收与角色相关的消息注册订阅。在内部,代理可以根据需要查询其内部内存以获取与当前任务相关的上下文详细信息。这有助于完善其理解并做出更好的决策。对消息所做的任何更新或更改都会在所有链接代理内存中同步,以保持信息的一致视图。这可以确保所有代理都可以访问最新的数据。

消息共享。每当代理生成消息时,它都会复制到共享环境日志中,创建单一事实来源。这确保所有代理都可以访问相同的信息。

基于角色的订阅。代理可以根据其角色及对其有意义的消息类型注册订阅。这是根据预定义标准完成的,以符合代理的职责和任务。

消息调度。当出现新的消息满足订阅条件时,它会自动发送通知相关的代理。这种主动传播信息可以防止代理错过重要更新。

内存缓存和索引。代理维护一个内部内存缓存,其中订阅的消息进行存储和索引,索引包括内容、发送者和接收者。这支持高效的信息存储和检索。

根据上下文的检索。环境维护一个共享的内存池,支持缓存和索引。同时,代理可以根据需要查询其内部内存,以获取相关上下文详细信息。这有助于完善其对当前任务的理解并做出更好的决策。

更新同步。对消息所做的任何更新或更改都会在所有链接代理内存中同步,以保持信息的一致视图。这确保所有代理都可以访问最新的数据。

通过围绕代理角色组织信息流,MetaGPT使自治代理能够有效地提供相关知识。这种模式反映了人类组织的运作方式。尽管每个人都可以访问共享记录,但个人会根据具体职责自定义视图。MetaGPT结合了集中化的知识共享与基于角色的个性化内存缓存,实现了自定义知识管理。这减少了无关数据并提供了共同的上下文。这种平衡了团队协调与个体效率。

3.3 多智能体协作示例

MetaGPT能够从一条用户指令生成整个软件系统。本节详细阐述图3,使用瀑布SOP。当提示“制作2048滑动拼图游戏”时:

爱丽丝(产品经理):准备编写PRD。当老板(用户)提出产品需求时,爱丽丝(产品经理)将起草7份文件,包括产品目标、用户故事、竞争分析(文字和四象限图)、需求分析、需求池和UI设计。在爱丽丝根据瀑布SOP将工作交给下一个LLM角色之前,她的工作将首先进行审查,如图3所示。审查后,爱丽丝将她的工作发布到消息队列的“写PRD”类别中。鲍勃,我们的LLM架构师,订阅了“写PRD”类别。此外,MetaGPT将通知用户其当前的API使用费用(以美元计):

1
总运行成本:$0.072 | 最大预算:$3.000 | 当前费用:$0.072,提示令牌=848,
2
完成令牌=771

鲍勃(架构师):准备编写设计。根据爱丽丝的需求分析和可行性分析,我们的架构师鲍勃将为该项目起草系统设计,首先是高层实施方法:

1
实施方法:我们将使用Python内置库进行核心游戏逻辑。
2
对于GUI,我们将使用开源库Pygame,它是一组用于编写视频游戏的Python模块。 它包含计算机图形和声音库。 对于高分追踪功能,我们将使用SQLite,一个C库,提供轻量级的基于磁盘的数据库。 SQLite允许我们在游戏关闭后持久保存最高分数。
3
对于测试,我们将使用Pytest,一个成熟的全面的Python测试工具。

遵循实施计划,架构师鲍勃将创建文件列表将复杂逻辑原子化为十几个文件:

1
["main.py",

2
"game.py",
3
"gui.py",
4
"database.py",
5
"test_game.py",
6
"test_gui.py",
7
"test_database.py"]

并生成mermaid图来定义数据结构和接口以及程序顺序流程图。

鲍勃将根据设计生成文件目录和空文件,并将所有文档和图表发布到“写设计”类别的消息队列中。

伊芙(项目经理):准备编写任务。伊芙订阅了“写设计”类别,使用所有之前起草的UI、系统设计和API设计文档,将项目分解为更简单、更易操作的任务,通常是单文件复杂度级别:

1
逻辑分析

2
[
3
("main.py", "包含主游戏循环并处理用户输入。"),
4
("game.py", "实现游戏逻辑,包括棋盘、分数和游戏结束条件。"),

5
("gui.py", "处理图形用户界面,包括绘制棋盘、分数和游戏结束屏幕。"),
6
("database.py", "管理最高分数据库,包括获取和更新最高分。"),
7
("test_game.py", "测试游戏逻辑。"),
8
("test_gui.py", "测试图形用户界面。"),
9
("test_database.py", "测试最高分数据库。")
10
]

此外,伊芙(项目经理)还将列出项目依赖项,包括用Python编写的第三方包以及其他语言和API规范。 如果存在缺失的细节,评论/反思过程将迭代改进当前阶段生成的内容,直到审查者满意。

亚历克斯(工程师):准备编写代码和编写代码审查。给定具体任务和连贯的整体实现计划的形式的“编写任务”消息,LLM代理拥有足够的信息来生成无错误的代码。 亚历克斯将按指定顺序遍历文件列表,并生成每个文件。 在第一次尝试中,MetaGPT成功生成了一个无错误的2048滑动拼图游戏。 所有这些都来自一行用户指令。

图6:MetaGPT生成的2048滑动拼图游戏运行时界面。

    实验

4.1 代码生成基准

任务选择。为了评估MetaGPT框架在代码生成方面的性能,特别是在单文件方案中,并证明其多代理协作的有效性,我们使用两个开源基准HumanEval[24]和MBPP[25]进行评估代码生成性能。 HumanEval基准包括164个手写编程任务。 每个任务包括函数规范、描述、参考代码和多个单元测试。 MBPP基准由427个Python编程任务组成,这些任务已手动验证。 这些任务涵盖了基本的编程概念和标准库功能。 每个任务都包括描述、参考代码和多个自动化测试用例。

基线和指标。我们利用[24]中提出的无偏版Pass@k来评估前k生成代码的功能准确性。这是通过运行测试用例完成的,描述如下:

Pass @k = E问题[1 - (n - c)/k / (n/k)]

本文主要关注评估Pass@1,因为我们认为框架在单次传递中实现代码生成成功对我们非常重要。 我们通过将最近在代码生成领域出现的特定领域LLM与普通领域LLM(如PaLM [46]、GPT-4 [47]和MetaGPT)进行比较评估,进行了对比评估,包括AlphaCode [28]、Incoder [43]、CodeGeeX [44]和Codex [24]和CodeT [45]。其中,MetaGPT利用4个代理,即工程师、产品经理、架构师和项目经理,并使用GPT4-32k作为底层语言模型。

在HumanEval和MBPP数据集中,我们修改了特定于角色的约束提示,要求MetaGPT框架生成单个函数,而不是完整的类。这种修改是为了方便后期的自动测试。

实验结果。图7表明,我们的MetaGPT明显优于其他方法,包括专业的代码生成框架,即CodeX、CodeT和当前可用的最强大语言模型GPT-4,在HumanEval和MBPP基准测试中都取得了最新状态的技术。

我们框架与早期方法之间的主要区别在于多智能体交互和人类标准操作程序的引入。这些因素对增强类似人类的问题解决能力做出了重大贡献。

值得注意的是,由于GPT-4的结构类似于纯工程师角色,我们在MetaGPT中的多智能体系统设计减少了编程歧义。因此,当MetaGPT与GPT-4协作时,与最强的单一基线GPT-4相比,在HumanEval基准测试中的Pass@1指标上相对提高了21.9%。

4.2 复杂任务评估方法

评估指标。为了精确评估我们的实验结果,我们制定了一系列考虑代码质量、文档、成本统计信息、修改成本和代码可执行性的指标。

    代码统计
        代码文件总数:此指标反映编码工作的规模,通过测量唯一代码文件的数量。
        代码文件中的总行数:此指标提供代码生成量的概述,通过统计代码文件中的所有行。
        每个代码文件中的平均行数:此测量表示典型代码复杂性,并通过计算每个代码文件中的平均行数来计算。
    文档统计信息
        文档文件总数:此指标表示生成的文档总数。它统计唯一文档文件的数量。
        文档中的总行数:此指标通过统计文档文件中的所有行来衡量文档中的书面内容量。
        每个文档文件中的平均行数:此指标表示文档文件平均长度和复杂度。
    成本统计信息
        总提示令牌:此指标反映所需的系统交互级别,通过在任务执行期间计数提示令牌的数量来衡量。
        总完成令牌:此指标表示生成的输出量,通过在任务执行期间计数完成令牌的数量来衡量。
        时间成本:这指执行任务过程的效率,通过完成任务所花费的总时间来衡量。
        金钱成本:此指标测量任务执行过程的成本效益。它计算为任务执行期间产生的总货币成本。
    修改成本:此指标测量代码维护所需的工作量。较高的值表示需要更高水平的代码改进和调试。
    代码可执行性
        生成代码的功能质量:根据完全失败到完美执行并完全符合任务规范的“F”到“P”的评分划分进行评估。
            F表示完全失败,得分0分。代码不可用或完全偏离规范。
            R表示可运行的代码,得分1分。代码可以执行,但可能不满足所有工作流需求。
            W表示在很大程度上预期的工作流程,得分2分。代码可以执行且大体上与规范一致。
            P表示与预期完全匹配,得分3分。代码功能完美,输出与规范完全对应。

实验设置。我们使用Python环境(版本3.9.6)中的MetaGPT进行了七项实验。这些实验旨在展示该系统在各种场景中的通用性和适用性,包括游戏生成、Web开发和数据分析。 具体而言,考虑到任务复杂性,我们进行多项实验,并选择表现最佳的结果。 对于每个框架,我们进行5次试验,每个试验最多允许3次代码修订。 我们使用实验代码从MetaGPT版本8cc8b80与GPT4-32k作为基础语言模型。 实验特定配置包括令牌消耗限制最大为1500,投资上限为3,最大迭代次数为5。 启用代码审查功能,并使用mermaid.js 2进行PDF和图表生成。 每个项目都经历一次生成过程。 完整的实验日志可在附录B中获得。

为了全面评估MetaGPT框架的性能,我们在各种任务上进行离线实验评估。这些任务经过精心选择,旨在测试该框架的可行性和普适性。这个各异的收集任务,涵盖各个领域和复杂度水平,我们精心选择提供全面的MetaGPT评估。 每项任务都根据关键指标进行评估,包括代码统计信息、文档统计信息、成本统计信息、修改成本和代码执行成功率。 为了更深入地理解我们的实验设置和结果,我们在附录B中包含了这些任务的一个子集。 在MetaGPT框架下创建项目平均需要516秒和1.12美元。 该项目通常由4.71个代码文件和3种文档组成。 在不超过3次错误修复的情况下,项目的成功率可以达到79.48%。

4.3 与备选方法的比较

本节清楚比较了MetaGPT、AutoGPT、LangChain与Python Read-Eval-Print Loop(REPL)工具和AgentVerse的功能,如表1所示。 它还包括实验以量化不同框架的性能。

框架功能比较。 MetaGPT通过其广泛的功能脱颖而出。 唯一属于MetaGPT的是生成PRD和技术设计的功能,这展示了其对项目执行的全面的方法。 MetaGPT是唯一能够生成API接口的框架,这为快速
API设计原型提供了优势。

代码审查是开发过程的关键阶段,在MetaGPT和AgentVerse中都有,但在AutoGPT和LangChain中明显缺失。 MetaGPT进一步通过集成预编译执行来区分自己,这个功能可以提早发现错误并增强代码质量。 在协作功能方面,MetaGPT和AgentVerse都支持基于角色的任务协作,这是一种机制,旨在鼓励多智能体协作并通过将任务分配给特定角色来增强团队合作。 然而,MetaGPT独特地提供了基于角色的任务管理,这不仅分解任务,还监督其管理,突出了其广泛的项目管理能力。

在评估代码生成能力时,所有这些框架都展现出熟练程度。 然而,MetaGPT提供了一个更全面的解决方案,解决了开发过程中的更广泛方面的问题,并提供了项目管理和执行的完整工具集。

这个比较基于各框架的当前状态。 未来的更新可能会增加或修改这些工具的功能。 但是,根据目前的分析,MetaGPT优于其竞争对手,提供了更全面和健壮的解决方案来执行项目。

定量实验比较。 为了评估各种框架(如MetaGPT、AutoGPT、LangChain和AgentVerse)的性能,我们在7项不同的任务上进行实验。 这些任务包括Python游戏生成、CRUD代码生成和简单的数据分析。 这种方法旨在阐明在考察下的每个框架的独特优势和劣势。 结果显示在表2中。
如表2所示,MetaGPT在各种任务中展现出强大的性能,在所有任务中都实现了成功执行。Flappy Bird是一个需要高水平交互的游戏,即使对于先进的编程系统也存在挑战。虽然MetaGPT能够为游戏生成可运行的代码,但由于严格的约束和进行手动调整的有限资源,结果并非完全无懈可击。与此形成对比的是,竞争框架AutoGPT、LangChain和AgentVerse在任何任务中都不能实现成功执行,这凸显了MetaGPT框架效力的明显区别。

MetaGPT的运行时统计数据详细提供在表3中。每个项目平均包含4.71个代码文件(包括但不限于css、py和js等格式),每个文件平均有42.99行代码,整个项目总共平均有191.57行代码。关于PRD文件,每个项目生成平均4个PRD文件(包括具有相同名称的pdf、mmd、svg和png)。另外,项目文档通常由每个项目3种资产文件组成。这些包括产品需求文档、API文档和系统架构文档。平均而言,每个文档包含80行。

在成本分析方面,每个项目消耗平均26626.86个提示令牌和6218.00个完成令牌,完成任务总共耗时517.71秒。与传统软件工程开发时间表和成本相比,MetaGPT的时间和财务支出不到千分之一。

我们使用代码修订指标来解决项目执行期间遇到的错误。这是通过替换依赖项、修改代码或其他纠正操作直到成功执行或出现下一个问题为止来实现的。代码中允许的最大修订次数为三。超过此限制将导致项目被视为失败(如果继续遇到错误)。关于代码修订,每个项目平均需要0.6次修订。大多数问题与依赖项、不可用的资源和丢失的参数有关。整体成功率(WP率 - 成功运行且基本满足预期)达到100.0%。

尽管AutoGPT是目前最广泛使用的单一代理框架,但在我们的实验中,使用GPT4-32k配置及其默认设置无法完成任何任务。作为单一代理,其特性必须在执行过程之前手动建立,执行过程中无法更改。AutoGPT能够将用户提供的任务分解为多个更小的子任务并顺序执行。然而,在整个实验过程中,我们的观察突出了AutoGPT的一个重大缺点:它缺乏任务完整性评估和单一代理的有限专业知识。

AutoGPT缺乏评估任务完整性的机制。它在保存生成的结果后简单地将任务标记为已完成,而不进行任何额外的验证或完整性检查。为提高循环效率,我们在LangChain中利用AutoGPT实现,并将其与Python REPL工具集成。我们希望使AutoGPT能够调试和优化其生成的代码。但是,缺乏专业知识使其无法利用解释器提供的反馈来提高成功率。因此,由于生成不完整和非功能代码,任务不成功。

尽管AgentVerse实现了三个专业化角色:编写者、测试者和审查者,但在所有基准任务中都未能发挥良好的作用。这些角色的协作方式类似于在线评判(OJ)。AgentVerse内的对话主要围绕三个角色展开:编写者创建代码;测试者识别失败或错误消息中的区域;审查者建议修改。这与我们在MetaGPT中实现的工程师类似,其功能是编码和代码审查。AgentVerse中的对话主要集中在代码本身,而不是整个任务上。

然而,没有负责将大任务分解成较小、更容易管理的任务的角色,这使AgentVerse处于不利地位。这种任务分解和工作分工的缺乏显著降低了完成更复杂任务的可能性。AgentVerse的缺点强调了在处理复杂问题解决方案时明确角色划分和策略任务分隔的重要性。

4.4 消除研究

我们的消除研究包括系统地减少参与开发过程的角色数量,随后检查其对可执行输出的影响。 我们选择Brick Breaker和Gomoku作为任务,因为它们的复杂性需要一个有着不同角色和多步工作流程的团队。 这类似于游戏开发的现实场景,需要明确的角色分工和团队合作。

我们对MetaGPT的初始实验是使用完备的团队进行的,由四个不同的角色组成:产品经理、架构师、项目经理和工程师,根据第4.2节中的实验设置。 对于消除研究,我们使用一组指标:代码文件中的总行数、金钱成本、修改成本和代码可执行性,如第4.2节中定义。 选择这些指标是为了方便量化诸如代码生成质量、任务成本效益和功能代码质量等因素。 在获得完整团队的结果后,我们在后续实验中逐步删除架构师、项目经理和产品经理的角色,评估其缺失如何影响整体任务性能。

如表4和表5所示,从团队中删除架构师或项目经理会导致代码统计量适度下降。 对于Brick Breaker,少了29行,对于Gomoku,少了33行,当架构师被删除时。 类似地,删除项目经理导致Brick Breaker减少14行,Gomoku减少47行。 此外,需要1-2次额外修订。 但是,任务的总体可执行性大体上得以保留。 当从三个角色转移到仅有两个角色时,即产品经理和工程师时,游戏测试显示代码量减少了62和63行,修订次数增加了2和3次。

此外,值得注意的是,当团队减少到单个代理时,代码的可执行性显著恶化。 即使发生了额外的修订成本,代码仍然不可执行。 因此,多个角色的存在不仅提高了代码质量,还增强了代码实现的健壮性和可行性。

总之,通过跨条件的定量比较,我们强调了专业化多智能体框架在复杂任务中的优势。 这种框架验证了明确的角色模块化和协作对整体任务完成的重要性。

    讨论和未来工作

尽管MetaGPT在自动化端到端过程方面具有巨大潜力,但它也存在一些局限性。 主要是它偶尔引用不存在的资源文件,如图像和音频。 此外,在执行复杂任务时,它倾向于调用未定义或未导入的类或变量。 这些现象广泛归因于内在于大语言模型的幻觉倾向,可以通过更清晰、高效的代理协作工作流程来处理。

    结论

在这项工作中,我们提出了MetaGPT,一种通过SOP进行协作代理的有前景的元编程技术,利用LLM来模拟高效的人类工作流程。 MetaGPT是一种利用SOP来协调基于LLM的多智能体系统的元编程技术。 具体来说,为了将SOP编码成提示,MetaGPT通过角色定义、任务分解、流程标准化等技术管理多代理。 它最终只需要一行需求就可以完成端到端的开发过程。

我们在软件开发中的示例展示了该框架的潜力,通过详细的SOP和提示。 实验结果表明,与现有的会话式和聊天式多智能体系统相比,我们的MetaGPT可以产生更全面、更连贯的解决方案。

我们认为这项工作为LLM型多智能体的交互和合作方式开辟了新的可能性,重新定义了复杂问题解决的格局,并指向通用人工智能的可能途径。 我们努力的主要贡献包括:

    引入元编程框架。我们提出了MetaGPT,这是基于LLM的多智能体协作的高级框架。 元编程范式使MetaGPT对于构建多智能体系统非常方便和灵活。 这为团队提供了一个轻松的平台,可以轻松地开发和验证协作多智能体系统。
    集成人类SOP流程设计。在一次开创性的努力中,我们成功地将SOP集成到系统设计中。 这种集成使我们基于LLM的代理能够生成各种不同的、高质量的、结构化的中间设计和文档。 它通过减少LLM基础多智能体协作中的错误显着增强了健壮性。 这种设计使系统具备按照人类团队的方式系统地解决复杂任务的能力,展示了与人类团队相似的解偶能力和问题解决能力。
    实现最先进的性能。我们通过严格的实验在HumanEval [24]和MBPP [25]基准测试中取得了新的最先进性能。 广泛的定量和定性分析令人信服地验证了MetaGPT在多智能体编程和复杂任务解析方面的有效性。 结果表明,MetaGPT有潜力解决LLM中的幻觉问题,从而引导面向更有效设计的协作LLM系统。
